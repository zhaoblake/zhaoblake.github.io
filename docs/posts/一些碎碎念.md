---
draft: false 
date: 2024-03-31 
categories:
  - Python
  - ç¢ç¢å¿µ
comments: true
authors: [Blake]
---

# ä¸€äº›ç¢ç¢å¿µ

æˆ‘ç»å¸¸ä¼šçœ‹åŒäº‹çš„ä»£ç ï¼Œå€’ä¸æ˜¯ä»€ä¹ˆæ€ªç™–ï¼ˆæƒ³åˆ°ä¹‹å‰çœ‹åˆ°çš„æ®µå­ï¼šä»£ç æ˜¯ç¨‹åºå‘˜çš„éšç§ï¼Œå°±åƒå†…è£¤ï¼Œæˆ‘æ‰¿è®¤æœ‰æ¼æ´ï¼Œä¸ç»™ä½ çœ‹åˆ°å°±è¡Œ...ğŸ˜¥ï¼‰ï¼Œä¸€æ–¹é¢çš„æ˜¯å·¥ä½œéœ€è¦ï¼Œç»´æŠ¤åˆ«äººçš„ä»£ç åœ¨æˆ‘å¸æ˜¯ä¸ªé«˜é¢‘çš„åœºæ™¯ã€‚å¦ä¸€æ–¹é¢ï¼Œå°±æ˜¯æ»¡è¶³æˆ‘ä¸ªäººçš„ç§æ¬²äº†ï¼šæˆ‘æ—¶ä¸æ—¶èƒ½åœ¨åŒäº‹çš„ä»£ç é‡Œï¼Œå‘ç°ä¸€äº›å¾ˆå·§å¦™çš„å†™æ³•ï¼Œæ¯æ¯è¿™æ—¶ï¼Œå¿ƒä¸­æš—è‡ªçªƒå–œï¼šåˆå­¦åˆ°äº†ï¼å½“ç„¶ï¼Œä¹Ÿä¼šå‘ç°ä¸€äº›æ¯”è¾ƒå¥‡æ€ªçš„å†™æ³• ğŸ¤¦â€â™‚ï¸ã€‚

<!-- more -->

## ç›´æ¥è°ƒç”¨é­”æ³•æ–¹æ³•



> The first thing to know about special methods is that they are meant to be called by the Python interpreter, and not by you. 
> 
> Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â        Luciano Ramalho, ***Fluent Python***



é­”æ³•æ–¹æ³•ï¼Œå®˜æ–¹å«ç‰¹æ®Šæ–¹æ³•ï¼ˆspecial methodsï¼‰ï¼Œä»¥åŒä¸‹åˆ’çº¿å¼€å¤´åŒä¸‹çº¿ç»“å°¾çš„æ–¹æ³•ï¼Œå¸¸è§çš„æœ‰ `__init__`ã€`__new__` ç­‰ã€‚

å¯¹äº Python å†…ç½®çš„ä¸€äº›å®¹å™¨ç±»å‹ï¼Œå­—å…¸ï¼Œåˆ—è¡¨ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥ `len` æ–¹æ³•æ¥è·å–å®ƒçš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯å…ƒç´ ä¸ªæ•°ã€‚å¦‚æœæˆ‘ä»¬è‡ªå·±å®ç°äº†ä¸€ä¸ªå®¹å™¨ç±»å‹ ï¼Œä¹Ÿæƒ³è®©å®ƒæ”¯æŒé€šè¿‡ `len` æ–¹æ³•æ¥è·å–å®ƒçš„é•¿åº¦ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆåšå‘¢ï¼Ÿ

æˆ‘ä»¬å…ˆå€ŸåŠ© `list` æ¥å®ç°ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆä»…ä½œä¸ºæ¼”ç¤ºä½¿ç”¨ï¼Œå‹¿ç”¨äºç”Ÿäº§ï¼‰ã€‚

```python
class Full(Exception):
    pass


class Empty(Exception):
    pass


class Queue:

    def __init(self, maxsize):
        self.maxsize = maxsize
        self._data = list()


def push(self, item):
    if len(self._data) == self.maxsize:
        raise Full
    self._data.append(item)


def get(self):
    if not self._data:
        raise Empty
    return self._data.pop(0)
```

æµ‹è¯•è¿™ä¸ªé˜Ÿåˆ—èƒ½ä¸èƒ½å·¥ä½œã€‚

```shell
>>> q = Queue(3)
>>> q.push(1)
>>> q.push(2)
>>> q.push(3)
>>> q.get()
1
>>> q.get()
2
>>> q.get()
3
>>> q.get()
Traceback (most recent call last):
...
__main__.Empty
```

å›åˆ°åˆšåˆšé‚£ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬ä¹Ÿæƒ³è®©å®ƒæ”¯æŒé€šè¿‡ `len` Â æ–¹æ³•æ¥è·å–å®ƒçš„é•¿åº¦ï¼Œè¦æ€ä¹ˆåšå‘¢ï¼Ÿ

å¯ä»¥é€šè¿‡å®šä¸€ä¸ªÂ `__len__`Â é­”æ³•æ–¹æ³•æ¥å®ç°ã€‚

```python
def __len__(self):
  return len(self._data)
```

```shell
>>> q = Queue(3)  
>>> q.push(1)
>>> q.push(2)
>>> q.push(3)
>>> len(q)
3
```

**å®šä¹‰çš„é­”æ³•æ–¹æ³•ç›®çš„ï¼Œæ˜¯è®©å®ƒæ”¯æŒ Python çš„ä¸€äº›è¯­æ³•æœºåˆ¶**ã€‚æˆ‘ä»¬ç»™è‡ªå®šä¹‰çš„ç±»å‹å®šä¹‰äº† `__len__` æ–¹æ³•ï¼Œç›®çš„æ˜¯ä¸ºäº†è®©å®ƒæ”¯æŒé€šè¿‡ `len` æ–¹æ³•è·å–é•¿åº¦ï¼Œè€Œä¸æ˜¯è¯´æˆ‘ä»¬è¦è‡ªå·±è°ƒç”¨ `__len__` æ–¹æ³•ã€‚

è¿™æ—¶å€™ï¼Œå¯èƒ½ä¼šæœ‰å°ä¼™ä¼´ä¼šé—®ï¼Œç›´æ¥è°ƒç”¨é­”æ³•æ–¹æ³•æ˜¯ä¸æ˜¯æ›´å¿«ï¼Ÿæé—®ç¯èŠ‚ğŸ™‹â€

æ¥ï¼Œåšä¸ªç®€å•çš„ benchmarkã€‚

```python
q = Queue(1000)
start = time.perf_counter()
for _ in range(10000):
    len(q)
end = time.perf_counter()
print(f"len: {end - start}")  

start = time.perf_counter()
for _ in range(10000):
    q.__len__()
end = time.perf_counter()
print(f"__len__: {end - start}")
```

ç»“æœå¦‚ä¸‹ ğŸ‘‡

```
len: 0.002637699999999993
__len__: 0.0023554999999999965
```

ç¡®å®ï¼Œç›´æ¥è°ƒç”¨é­”æ³•æ–¹æ³•çš„ç¡®æ›´å¿«ã€‚è¿™å¾ˆå¥½ç†è§£ï¼Œå› ä¸º `len(q)`  æ—¶ï¼ŒPython æœ€ç»ˆè°ƒç”¨çš„è¿˜æ˜¯ `q.__len__`ï¼Œè€Œç›´æ¥è°ƒç”¨ `__len__` æ²¡æœ‰äº†ä¸­é—´å•†èµšå·®ä»·ã€‚

ä½†**æ€§èƒ½ä¼˜åŒ–ç¬¬ä¸€æ­¥å…ˆæ˜¯æ‰¾åˆ°ç¨‹åºçš„æ€§èƒ½ç“¶é¢ˆï¼Œå†é’ˆå¯¹ç“¶é¢ˆè¿›è¡Œä¼˜åŒ–**ã€‚æ‰€ä»¥ï¼Œè¿™é‡ŒçœŸçš„æ˜¯ä½ ç¨‹åºçš„æ€§èƒ½ç“¶é¢ˆå—ğŸ¤”ï¼Ÿ



## å¿½ç•¥å¼‚å¸¸ä¸åšä»»ä½•å¤„ç†

> ErrorsÂ shouldÂ neverÂ passÂ silently.
> 
> Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Tim Peters, ***The Zen of Python***



æˆ‘è§è¿‡å¾ˆå¤šï¼Œè‡ªå·±ä¹Ÿå†™è¿‡ç±»ä¼¼ä¸‹é¢çš„ä»£ç ï¼šæ•è·å¼‚å¸¸ï¼Œç„¶åå¿½ç•¥æ‰ä¸åšä»»ä½•å¤„ç†ã€‚

è¿™æ˜¯ä¸€ç§æå…¶å±é™©çš„å†™æ³•ï¼Œè¿™é‡Œçš„å¼‚å¸¸å¯èƒ½ä¼šäº§ç”Ÿè¿é”ååº”ï¼Œé€ æˆåç»­çš„å„ç§å¥‡å¥‡æ€ªæ€ªçš„ bugã€‚ç”±äºå¼‚å¸¸å¹¶æ²¡æ³•è¢«è®°å½•ä¸‹æ¥ï¼Œæ— ç–‘ç»™åç»­çš„å›æº¯æ’æŸ¥å¢åŠ éš¾åº¦ã€‚å¦‚æœè¿™ä¸ª bug è¿˜ä¸èƒ½ç¨³å®šå¤ç°ï¼Œç›´æ¥å‡å¤©ğŸ˜µ...

```python
try:
    ...
except:  # bad
    pass


try:
    ...
except Exception:  # bad
    pass
```

è‡³å°‘ï¼Œæ‰“ä¸ªæ—¥å¿—è®°å½•ä¸‹ã€‚æ—¥å¿—ç­‰çº§æ¨èä½¿ç”¨ `ERROR` æ¥æ ‡æ˜è¿™é‡Œå‡ºç°äº†å¼‚å¸¸ã€‚

```python
try:
  ...
except Exception as e:  # at very least, log it
  logger.error(e)
```

## æ— ç”¨ä»£ç åªæ³¨é‡Šä¸åˆ é™¤

> Once code isnâ€™t used any more, we should delete it. I donâ€™t worry that I may
> need it sometime in the future; should that happen, I have my version control
> system so I can always dig it out again. If itâ€™s something I really think I may need
> one day, I might put a comment into the code that mentions the lost code and
> which revision it was removed inâ€”but, honestly, I canâ€™t remember the last time
> I did that, or regretted that I hadnâ€™t done it.
> 
> Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â   Martin Fowler, ***Refactoring***



è¿™æ®µä»£ç å·²ç»åºŸå¼ƒäº†ï¼Œæ˜¯æ³¨é‡Šè¿˜æ˜¯åˆ é™¤ï¼Ÿæé—®ç¯èŠ‚ğŸ™‹â€

æˆ‘åœ¨æŸæ¬¡çš„å†…éƒ¨åˆ†äº«ä¸Šé—®äº†ä¸Šé¢çš„é—®é¢˜ï¼Œå¾—åˆ°ä¸€ä¸ªä¹ˆæ£±ä¸¤å¯çš„å›ç­”ï¼šâ€çœ‹æƒ…å†µâ€œã€‚åœ¨æˆ‘çœ‹æ¥è¿™ä¸ªé—®é¢˜å¹¶æ²¡æœ‰ä»€ä¹ˆå¯ä¹ˆæ£±ä¸¤å¯çš„ç©ºé—´ï¼šç›´æ¥åˆ äº†å°±è¡Œã€‚**é—ç•™çš„æ— ç”¨ä»£ç ï¼ˆå³ä½¿è¢«æ³¨é‡Šæ‰ï¼‰ï¼Œåªä¼šç™½ç™½å¢åŠ ä»£ç çš„å¤æ‚åº¦ï¼Œå¢åŠ é˜…è¯»è€…çš„å¿ƒæ™ºæˆæœ¬**ã€‚

å¯èƒ½ä¼šæœ‰åŒå­¦ä¼šé—®ï¼Œä¸‡ä¸€è¿™æ®µä»£ç æˆ‘åé¢è¿˜ä¼šç”¨æ€ä¹ˆåŠï¼Ÿ

ä¼šä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Ÿç¡®å®ä¼šï¼Œä½†æ˜¯éå¸¸å°‘ã€‚è‡³å°‘åœ¨æˆ‘çš„å·¥ä½œç»å†ä¸­ï¼Œä»£ç è¢«åˆ äº†ï¼Œåé¢åˆç”¨åˆ°çš„è¿™ç§æƒ…å†µåŸºæœ¬æ²¡æœ‰ã€‚ä¸å¿…ä¸ºäº†è¿™ç§æå°‘å‘ç”Ÿçš„æƒ…å†µï¼ŒæŠŠä¸ç”¨çš„ä»£ç ç•™ä¸‹æ¥ã€‚å†µä¸”ï¼Œç”±äºç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„å­˜åœ¨ï¼Œè¿™äº›ä»£ç çš„æ”¹åŠ¨ä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œä½ åˆ äº†ï¼Œè¿˜èƒ½é€šè¿‡ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ‰¾å›æ¥ã€‚

## ä¸æ°å½“åœ°ä½¿ç”¨åå°„

> Itâ€™s very tempting to use these â€œcoolâ€ features when theyâ€™re not absolutely necessary. Itâ€™s harder to read, understand, and debug code thatâ€™s using unusual features underneath. 
> 
> Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â                   ***Google Python Style Guide***



PythonÂ ä¸­æœ‰å¾ˆå¤šæ–¹æ³•åˆ©ç”¨äº†åå°„æœºåˆ¶ï¼Œä¾‹å¦‚ï¼š`type`ï¼Œ`isinstance`ï¼Œ`callable`ï¼Œ`gettarr`Â ç­‰ï¼Œä»Šå¤©å…ˆåªæ¬ºè´ŸÂ `getattr`Â å®ƒä¸€ä¸ªï¼Œå…ˆç®€å•æ¼”ç¤ºä¸‹Â `getattr`Â çš„ç”¨æ³•ã€‚

```python
class Person:

    def __init__(self, name, gendr):
        self.name = name
        self.gender = gender

    @staticmethod
    def eat(food):
        print(f"eating {food}...")


>>> p = Person("Blake", "male")
>>> getattr(p, "name")
Blake
>>> getattr(p, "eat")(meat)
eating meat...
```

ç®€å•æ¥è¯´ï¼Œå°±æ˜¯é€šè¿‡å­—ç¬¦ï¼Œæ¥è·å–å¯¹è±¡çš„å±æ€§æˆ–æ–¹æ³•ã€‚

æ­£å¦‚è°·æ­Œ Python ä»£ç é£æ ¼æŒ‡å—ä¸­æ‰€è¿°ï¼Œ**ä¸šåŠ¡ä»£ç ä¸­å°½é‡é¿å…ä½¿ç”¨ `gettattr` æˆ–è¯¸å¦‚æ­¤ç±»çš„ powerful featuresï¼Œä½ è¦æ¸…æ¥šçš„äº†è§£åˆ°ä½¿ç”¨å…¶æ‰€å¸¦æ¥çš„æˆæœ¬ï¼šä»£ç å¤æ‚æ€§å˜é«˜ã€å¯è¯»æ€§ä¸‹é™ã€è°ƒè¯•å›°éš¾...**

è¿™å°±æ˜¯æ²™æ¼ é‡Œé¢çš„ä¸€ç“¶å°¿ï¼Œä¸åˆ°ä¸‡ä¸å¾—å·²ï¼Œä¸è¦å–ã€‚

## å‚è€ƒèµ„æ–™

- [Fluent Python: Clear, Concise, and Effective Programming](https://book.douban.com/subject/27028517/)

- [Refactoring: Improving the Design of Existing Code](https://book.douban.com/subject/30468597/)

- [PEP 20 â€“ The Zen of Python | peps.python.org](https://peps.python.org/pep-0020/)

- [Avoiding Silent Failures in Python: Best Practices for Error Handling](https://pybit.es/articles/python-errors-should-not-pass-silently/)

- [Google Python Style Guide](https://zh-google-styleguide.readthedocs.io/en/latest/google-python-styleguide/contents/)