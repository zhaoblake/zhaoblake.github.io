---
draft: false 
date: 2024-04-08
categories:
  - Python
comments: true
authors: [Blake]
---
# è®°ä¸€æ¬¡çº¿ä¸Šäº‹æ•…

è¿™æ˜¯å»å¹´å¹´åº•å°±å‘ç”Ÿçš„äº‹æƒ…äº†ï¼Œè‡³äºä¸ºå•¥ç°åœ¨æ‹¿å‡ºæ¥è¯´ï¼Œæ˜¯å› ä¸ºæˆ‘åœ¨æµè§ˆä»“åº“çš„çš„æäº¤è®°å½•æ—¶ï¼Œä¸€ä¸ªç›´ç™½ã€æ®‹é…·çš„ commit message å†ä¸€æ¬¡åœ°æ‰è¿›æˆ‘çš„çœ¼é‡ŒğŸ˜µï¼šè¿˜åŸ xxxï¼ˆæˆ‘çš„åå­—ï¼‰æäº¤é”™è¯¯ã€‚è¿™æ˜¯æˆ‘åŒäº‹æäº¤çš„ commitï¼Œç”¨äºå›é€€æˆ‘ä¹‹å‰æäº¤çš„éƒ¨åˆ†ä»£ç ã€‚å°±æ˜¯è¿™éƒ¨åˆ†ä»£ç ï¼Œå¯¼è‡´äº†è¿™æ¬¡çº¿ä¸Šäº‹æ•…...

<!-- more -->
## èƒŒæ™¯

æˆ‘ä»¬æ”¶åˆ°äº†ä¸ºæŸä¸ªä»»åŠ¡æ‰§è¡Œæé€Ÿçš„éœ€æ±‚ï¼šå¹¶å‘æ‰§è¡Œã€‚æˆ‘ä»¬çš„ä»»åŠ¡æ‰§è¡Œå¼•æ“æ˜¯æ”¯æŒåç¨‹å¼‚æ­¥æ‰§è¡Œçš„ï¼Œä½†æ˜¯è¿™ä¸ªä»»åŠ¡çš„ä¸šåŠ¡ä»£ç æ˜¯åŒæ­¥çš„ã€‚æœ‰ä¸¤ç§æ–¹æ¡ˆæ‘†åœ¨é¢å‰ï¼š1. å°†ä»»åŠ¡ä»£ç æ”¹æˆå¼‚æ­¥ï¼›2. å¼•æ“æ–°å¢ä¸€ä¸ª runnerï¼Œæ”¯æŒå¤šçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚ 
é‰´äºæ—¶é—´è¾ƒä¸ºç´§å¼ ï¼Œä¿®æ”¹ä»»åŠ¡ä»£ç çš„å·¥ä½œé‡å’Œé£é™©è¦è¿œå¤§æ–°å¢ä¸€ä¸ªå¤šçº¿ç¨‹æ‰§è¡Œçš„ runnerï¼Œæˆ‘ä»¬æœ€ç»ˆé€‰æ‹©çš„ç¬¬äºŒä¸ªæ–¹æ¡ˆï¼Œè¿™ä¸ªä»»åŠ¡ä¹Ÿè¢«æˆ‘ç»™æ¥ä¸‹äº†ã€‚
æ–°åŠ ä¸€ä¸ªçº¿ç¨‹ runner å¹¶ä¸å¤æ‚ï¼Œå†åŠ ä¸Šä¸€äº›é”çš„å¤„ç†ï¼ŒåŠå¤©æ—¶é—´å°±å¼€å‘å®Œæ¯•ï¼Œæäº¤ä¸Šçº¿äº†ã€‚

## äº‹æ•…

å½“å¤©ä¸‹ç­åï¼Œæˆ‘åœ¨å›å®¶çš„åœ°é“ä¸Šï¼Œæ¥åˆ°åŒäº‹çš„ç”µè¯ï¼šæˆ‘æäº¤çš„ä»£ç æœ‰é—®é¢˜ï¼Œçº¿ä¸Šç‚¸äº†ï¼ï¼ï¼
æˆ‘ç¬¬ä¸€ååº”æ˜¯ä¸å¯èƒ½ï¼Œæˆ‘åªæ˜¯æ–°å¢äº†ä¸€ä¸ªçº¿ç¨‹ runner å‡½æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¢é‡å¼€å‘ï¼Œè¿˜æ²¡æœ‰ä»»ä½•ä¸šåŠ¡çš„ä»»åŠ¡åˆ‡æ¢åˆ°è¿™ä¸ª runner æ‰§è¡Œã€‚
æœ€ååŒäº‹æ’æŸ¥ç»“æœæ˜¯ï¼šæˆ‘åˆ é™¤äº†ä¸€äº›â€œæ— ç”¨â€çš„å¯¼å…¥ï¼ˆimportï¼‰ã€‚


## `__init__subclass__`

æ²¡é”™ï¼Œè¿™æ¬¡çš„äº‹æ•…è·Ÿ `__init__subclass` æœ‰å…³ã€‚

`__init__subclass` æ˜¯ä¸€ä¸ªç‰¹æ®Šæ–¹æ³•ï¼ˆspecial methodï¼‰ï¼Œå®šä¹‰åœ¨çˆ¶ç±»ä¸­ï¼Œå½“å­ç±»è¢«åˆ›å»ºæ—¶ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚

```python
class BaseClass:
    
    def __init_subclass__(cls, **kwargs):
        print("A subclass of BaseClass is being created")

        
class SubClass(BaseClass):
    pass
```

ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå½“å­ç±» `SubClass` **è¢«åˆ›å»ºæ—¶**ï¼Œå°±ä¼šè§¦å‘ `BaseClass` çš„ `__init__subclass__` æ–¹æ³•ã€‚
åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ³¨å†Œå­ç±»çš„æœºåˆ¶ã€‚

```python
# listener.py
listeners = set()


class Listener: 
    
    def __init_subclass__(cls, **kwargs):
        listeners.add(cls)
        
    def run(self):
        raise NotImplemented
  

class AListener(Listener):
    
    def run(self):
        print("Listener A is running")


class BListener(Listener):
    
    def run(self):
        print("Listener A is running")
```

```shell
>>> from listener import listeners
>>> listeners
{<class 'listener.AListener'>, <class 'listener.BListener'>}
```

ç»“æœç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼Œä¸€åˆ‡éƒ½æ˜¯å¦‚æ­¤çš„å¹³é™ä¸”ç¾å¥½ğŸ™ã€‚

å½“ listener æ•°é‡å˜å¤šæ—¶ï¼Œlistener.py æ–‡ä»¶ä¸­å­˜æ”¾äº†å„ç§ç±»å‹çš„ listener è€Œå˜å¾—æ··ä¹±ï¼Œæˆ‘ä»¬æŠŠä¸åŒç±»å‹çš„ listener æ”¾åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ã€‚

```python
# listener.py
listeners = set()


class Listener: 
    
    def __init_subclass__(cls, **kwargs):
        listeners.add(cls)
        
    def run(self):
        raise NotImplemented
```
```python
# a_listener.py
from listener import Listener

class A1Listener(Listener):
    
    def run(self):
        print("Listener A1 is running")
        

class A2Listener(Listener):
    
    def run(self):
        print("Listener A2 is running")
        
...
```
```python
# b_listener.py
from listener import Listener

class B1Listener(Listener):
    
    def run(self):
        print("Listener B1 is running")
        

class B2Listener(Listener):
    
    def run(self):
        print("Listener B2 is running")
        
...
```
äºæ˜¯...

```shell
>>> from listener import listeners
>>> listeners
set()
```
WTF? ğŸ˜±

å®šä¹‰åœ¨ a_listener.py å’Œ b_listener.py ä¸­çš„ listeners æ²¡æœ‰è¢«ç›´æ¥ä½¿ç”¨ï¼ˆå¯¼å…¥ï¼‰è¿‡ï¼Œå¯¹äº Python è§£é‡Šå™¨æ¥è¯´ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸å¯è§çš„ï¼Œå› æ­¤è§£é‡Šå™¨ä¹Ÿä¼šä¸å»åˆ›å»ºè¿™äº› listener ï¼Œä¹Ÿå°±ä¸ä¼šè§¦å‘çˆ¶ç±»çš„ `__init__subclass__` è¿›è¡Œæ³¨å†Œã€‚

```shell
>>> import a_listener
>>> import b_listener
>>> from listener import listeners
>>> listeners
{<class 'a_listener.A2Listener'>, <class 'b_listener.B2Listener'>, <class 'a_listener.A1Listener'>, <class 'b_listener.B1Listener'>}
```
åœ¨æˆ‘ä»¬å¯¼å…¥åï¼ŒPython è§£é‡Šå™¨ä¼šæ‰§è¡Œè¢«å¯¼å…¥æ–‡ä»¶ä¸­çš„ä»£ç ï¼Œåˆ›å»ºå¯¹åº”çš„ listener, è§¦å‘çˆ¶ç±»çš„ `__init__subclass__` è¿›è¡Œæ³¨å†Œã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦åœ¨å…¥å£æ–‡ä»¶å¯¼å…¥ listeners æ‰€åœ¨çš„æ–‡ä»¶å°±è¡Œäº†ï¼Œä¼¼ä¹ä¸€åˆ‡åˆå¹³é™ä¸”ç¾å¥½äº†ï¼Ÿ
å¯¼å…¥äº†è¿™äº›æ–‡ä»¶ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨ï¼Œä»»ä½•ç°ä»£çš„ IDE éƒ½ä¼šåœ¨è¿™é‡Œå‘ä½ å‘å‡ºç±»ä¼¼ â€œunused import statementâ€ çš„è­¦å‘Šï¼Œå³ä½¿ç¨‹åºå¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚
ä¸€åŒåä½œçš„åŒäº‹ï¼Œå¹¶ä¸æ˜ç™½è¿™äº›â€œæ— ç”¨â€å¯¼å…¥çš„æ„å›¾ï¼ˆç‰¹åˆ«æ˜¯ä»£ç ä¸­æ²¡æœ‰è¿›è¡Œä»»ä½•è¯´æ˜ï¼‰ï¼Œå¯èƒ½ä¼šé¡ºæ‰‹åˆ é™¤æ‰ã€‚ å¦‚æœ IDE ä¼šé…ç½®äº† linterï¼Œè¿™äº›æœªè¢«ä½¿ç”¨çš„å¯¼å…¥ä¹Ÿä¼šè¢«è‡ªåŠ¨æ ¼å¼åŒ–æ‰ã€‚
è¿™å°±æ˜¯è¿™æ¬¡äº‹æ•…çš„åŸå› ï¼Œæˆ‘åˆ é™¤äº†ä¸€äº›â€œæ— ç”¨â€çš„å¯¼å…¥ï¼ˆimportï¼‰ï¼Œä½†å®é™…ä¸Šè¿™äº›å¯¼å…¥ä»¥ä¸€ç§**æå…¶éšå¼**åœ°æ–¹å¼ï¼Œè¾…åŠ©å®Œæˆäº†ä¸€äº›æ³¨å†Œæ“ä½œã€‚




## ä¼˜åŒ–
> Explicit is better than implicit.
>Tim Peters, ***The Zen of Python***


äº‹åï¼ŒåŒäº‹ä¸ºäº†é˜²æ­¢å†æœ‰äººè¯¯åˆ ï¼Œåœ¨å¯¼å…¥çš„åœ°æ–¹åŠ ä¸ªæ³¨é‡Šï¼šåˆ‡å‹¿åˆ é™¤ã€‚
è¿™ä¹ˆåšå¯ä»¥ä¸€å®šç¨‹åº¦ç¡®ä¿è¿™äº›å¯¼å…¥ä¸å†è¢«äººä¸ºåœ°è¯¯åˆ ï¼Œä½†ä¾æ—§å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š
1. å…¶ä»–äººçœ‹åˆ°è¿™é‡Œè¿˜æ˜¯ä¼šå¾ˆå›°æƒ‘ï¼Œä¸æ˜ç™½è¿™äº›æœªè¢«ä½¿ç”¨çš„å¯¼å…¥çš„ä½œç”¨æ˜¯ä»€ä¹ˆã€‚
2. IDE å¦‚æœé…ç½®äº† linterï¼Œä¼šæŠŠè¿™äº›æœªä½¿ç”¨çš„å¯¼å…¥ç»™æ ¼å¼åŒ–æ‰ã€‚

ä¸‹é¢æ˜¯ä¸¤ç§æ¯”è¾ƒç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚

æ–¹æ¡ˆä¸€ï¼šå°†å¯¼å…¥è¯­å¥æ”¾å…¥ä¸€ä¸ªæ³¨å†Œå‡½æ•°ä¸­ï¼Œåœ¨ç¨‹åºå…¥å£å¤„æ˜¾ç¤ºè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚
```python
def register_listeners():
    """æ³¨å†Œç›‘å¬è€…
    
    é€šè¿‡å¯¼å…¥ç¡®ä¿ç›‘å¬è€…è¢«åˆ›å»º
    """
    import a_listener
    import b_listener

...

# ç¨‹åºå…¥å£å¤„æ˜¾å¼è°ƒç”¨
register_listeners()
```
æ–¹æ¡ˆäºŒï¼šä¸ä½¿ç”¨ `__init_subclass__`ï¼Œåœ¨ä¸€ä¸ªæ³¨å†Œå‡½æ•°ä¸­æ˜¾ç¤ºæ·»åŠ  listenerï¼Œåœ¨ç¨‹åºå…¥å£å¤„æ˜¾ç¤ºè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚
è¿™ä¸å°±æ˜¯æœ€ç®€å•æœ´ç´ çš„å†™æ³•å—ï¼Ÿæ²¡é”™ï¼Œå…¥è¡Œè¶Šä¹…ï¼Œä»£ç å†™çš„è¶Šå¤šï¼Œæ¸æ¸åœ°ä¼šå€¾å‘äºå†™è¿™ç§ç®€å•æœ´ç´ çš„ä»£ç ï¼Œç‰¹åˆ«æ˜¯åœ¨å›¢é˜Ÿåä½œä¸­ï¼Œè®©åŒäº‹èƒ½å¤Ÿçœ‹å¾—æ‡‚å¹¶å¿«é€Ÿå¹¶ä¸Šæ‰‹ä½ çš„ä»£ç æ˜¯ä¸€ä»¶å¾ˆé‡è¦çš„äº‹ï¼ŒReadability counts ï¼

```python
from listener import listeners
from a_listener import A1Listener, A2Listener
from b_listener import B1Listener, B2Listener


def register_listeners():
    """æ³¨å†Œç›‘å¬è€…"""
    listeners.add(A1Listener)
    listeners.add(A2Listener)
    listeners.add(B1Listener)
    listeners.add(B2Listener)

...

# ç¨‹åºå…¥å£å¤„æ˜¾å¼è°ƒç”¨
register_listeners()
```

## æ•™è®­

- ä¸è¦ä¹±åŠ¨åˆ«äººä»£ç ï¼Œå³ä½¿æ˜¯æ ¼å¼åŒ–ã€‚
- ä¸è¦åˆ©ç”¨å¯¼å…¥ï¼ˆimportï¼‰æ¥éšå¼åœ°å®ç°æŸäº›é€»è¾‘ã€‚


